{% extends "base.html" %}

{% macro flight_row(flight, icon) %}
<div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
        <div class="w-8 h-8 flex items-center justify-center text-primary">
            <span class="material-symbols-outlined text-2xl">{{ icon }}</span>
        </div>
        <span class="text-sm font-semibold">{{ flight.departure_time.strftime('%a %d %b') }}</span>
    </div>
    <div class="flex items-center gap-4">
        <div class="text-center">
            <div class="text-sm font-bold">{{ flight.origin }}</div>
            <div class="text-[10px] text-slate-400 font-medium">{{ flight.departure_time.strftime('%H:%M') }}</div>
        </div>
        <span class="material-symbols-outlined text-slate-600 text-lg">arrow_forward</span>
        <div class="text-center">
            <div class="text-sm font-bold">{{ flight.destination }}</div>
            <div class="text-[10px] text-slate-400 font-medium">{{ flight.arrival_time.strftime('%H:%M') }}</div>
        </div>
    </div>
</div>
{% endmacro %}

{% block content %}
<header class="sticky top-0 z-40 bg-background-dark/80 ios-blur border-b border-slate-800 px-4 py-4">
    <h1 class="text-xl font-bold tracking-tight">Alerts</h1>
</header>

{% if alert_items %}
<main class="p-4 space-y-4 pb-32">
    {% for item in alert_items %}
    <a href="/deal/{{ item.destination_code }}?profile_id={{ item.profile.id }}"
       class="bg-card-dark rounded-2xl shadow-sm border border-slate-800 overflow-hidden block active:bg-slate-800/50 transition-colors">
        <div class="p-4">
            <!-- Profile badge -->
            <div class="mb-3">
                <span class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-slate-800 rounded-full text-[11px] font-medium text-slate-400">
                    <span class="material-symbols-outlined text-[14px]">person</span>
                    {% if item.is_shared %}
                        {{ item.profile.user.username }}'s {{ item.profile.name }}
                    {% else %}
                        {{ item.profile.name }}
                    {% endif %}
                </span>
            </div>

            <!-- Destination header + price -->
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-2 min-w-0 flex-1 mr-3">
                    <h2 class="text-xl font-bold truncate">{{ item.destination_name }}</h2>
                    <img src="{{ item.country_flag }}" alt="{{ item.country_code }}" class="w-6 h-4 rounded-sm object-cover shadow-sm flex-shrink-0">
                    <span class="text-slate-500 font-mono text-xs font-semibold bg-slate-800 px-1.5 py-0.5 rounded flex-shrink-0">{{ item.destination_code }}</span>
                </div>
                <div class="text-right flex-shrink-0">
                    <div class="text-2xl font-black text-accent-green leading-none">
                        &euro;{{ "%.0f"|format(item.best_deal.total_price_pp) }}
                    </div>
                </div>
            </div>

            <!-- Flight rows -->
            <div class="space-y-4 py-4 border-t border-slate-800">
                {{ flight_row(item.best_deal.outbound, 'flight_takeoff') }}
                {{ flight_row(item.best_deal.inbound, 'flight_land') }}
            </div>

            <!-- Other dates hint -->
            {% if item.other_count > 0 %}
            <p class="text-primary text-xs font-bold text-center py-1">
                {{ item.other_count }} other date{{ 's' if item.other_count > 1 }} available
            </p>
            {% endif %}
        </div>
    </a>
    {% endfor %}
</main>

{% else %}
<!-- Empty state -->
<main class="flex flex-col items-center justify-center px-8 text-center min-h-[calc(100dvh-200px)]">
    <div class="mb-8 relative">
        <div class="w-32 h-32 bg-primary/10 rounded-full flex items-center justify-center animate-pulse">
            <span class="material-symbols-outlined text-6xl text-primary opacity-60">notifications_off</span>
        </div>
    </div>
    <h2 class="text-2xl font-bold mb-3">No active alerts</h2>
    <p class="text-slate-400 text-base leading-relaxed max-w-[280px]">
        Toggle the bell icon on any deal to get notified about price changes.
    </p>
    <a href="/"
       class="mt-8 inline-flex items-center gap-2 bg-primary hover:bg-blue-600 text-white px-8 py-3.5 rounded-2xl font-bold transition-all active:scale-95 shadow-lg shadow-blue-500/20">
        <span class="material-symbols-outlined text-xl">local_fire_department</span>
        View Deals
    </a>
</main>
{% endif %}

{% endblock %}
